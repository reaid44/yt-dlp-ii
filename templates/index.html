<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ClassicTube Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        /* আগের সুন্দর স্টাইলই রাখলাম, শুধু কিছু ছোট পরিবর্তন */
        *{margin:0;padding:0;box-sizing:border-box;}
        body{background:linear-gradient(135deg,#000,#1a1a2e);color:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:15px;font-family:'Inter',sans-serif;}
        .container{max-width:420px;width:100%;background:rgba(25,25,35,0.95);border-radius:20px;padding:30px;box-shadow:0 20px 50px rgba(0,0,0,0.8);border:1px solid #333;backdrop-filter:blur(10px);}
        h1{font-family:'Cinzel',serif;font-size:2.8rem;text-align:center;background:linear-gradient(45deg,#ffd700,#ffed99);-webkit-background-clip:text;color:transparent;}
        .input-box{display:flex;gap:12px;margin:20px 0;}
        input{flex:1;padding:16px;border:2px solid #444;border-radius:12px;background:#1e1e2e;color:#fff;font-size:1rem;}
        button{padding:16px 24px;border:none;border-radius:12px;font-weight:600;cursor:pointer;background:linear-gradient(45deg,#ffd700,#ffed4e);color:#000;}
        button:hover{transform:scale(1.05);}
        .info-card img{width:100%;border-radius:12px;margin:15px 0;max-height:200px;object-fit:cover;}
        .options{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin:20px 0;}
        select{padding:14px;border-radius:10px;background:#1e1e2e;color:#fff;border:2px solid #444;}
        .btn-group{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:20px;}
        .btn-dl{padding:18px;font-weight:bold;border-radius:12px;}
        .mp4{background:linear-gradient(45deg,#00d0ff,#00ff9d);color:#000;}
        .mp3{background:linear-gradient(45deg,#ff0088,#ff6bc7);color:#fff;}
        .btn-dl:hover{transform:translateY(-4px);box-shadow:0 10px 20px rgba(0,0,0,0.5);}
        .spinner{width:50px;height:50px;border:5px solid #333;border-top:5px solid #ffd700;border-radius:50%;animation:spin 1s linear infinite;margin:30px auto;}
        @keyframes spin{to{transform:rotate(360deg);}}
        .hidden{display:none;}
    </style>
</head>
<body>
    <div class="container">
        <h1>ClassicTube</h1>
        <p style="text-align:center;opacity:0.8;margin-bottom:20px;">Premium YouTube Downloader</p>

        <div class="input-box">
            <input type="text" id="urlInput" placeholder="YouTube লিংক পেস্ট করো...">
            <button onclick="fetchInfo()">Fetch</button>
        </div>

        <div id="loading" class="hidden">
            <div class="spinner"></div>
            <p style="text-align:center;">লোড হচ্ছে...</p>
        </div>

        <div id="videoInfo" class="hidden">
            <div class="info-card">
                <img id="thumb" src="" alt="Thumbnail">
                <h3 id="title">Title</h3>
                <p id="channel">Channel</p>
            </div>

            <div class="options">
                <div>
                    <label style="display:block;margin-bottom:8px;color:#aaa;">কোয়ালিটি</label>
                    <select id="resolution">
                        <option value="2160">4K</option>
                        <option value="1440">1440p</option>
                        <option value="1080" selected>1080p</option>
                        <option value="720">720p</option>
                        <option value="480">480p</option>
                        <option value="360">360p</option>
                        <option value="audio">Audio Only</option>
                    </select>
                </div>
                <div id="audioDiv" style="display:none;">
                    <label style="display:block;margin-bottom:8px;color:#aaa;">অডিও</label>
                    <select id="audioBitrate">
                        <option value="320">320kbps</option>
                        <option value="256">256kbps</option>
                        <option value="192" selected>192kbps</option>
                        <option value="128">128kbps</option>
                    </select>
                </div>
            </div>

            <div style="text-align:center;margin:15px 0;">
                <input type="checkbox" id="playlist">
                <label for="playlist">পুরো প্লেলিস্ট</label>
            </div>

            <div class="btn-group">
                <button class="btn-dl mp4" onclick="triggerDownload('mp4')">MP4 ডাউনলোড</button>
                <button class="btn-dl mp3" onclick="triggerDownload('mp3')">MP3 ডাউনলোড</button>
            </div>
        </div>
    </div>

    <script>
        let currentUrl = "";

        document.getElementById('resolution').addEventListener('change', () => {
            document.getElementById('audioDiv').style.display = 
                document.getElementById('resolution').value === 'audio' ? 'block' : 'none';
        });

        async function fetchInfo() {
            const url = document.getElementById('urlInput').value.trim();
            if (!url) return Swal.fire("লিংক দে!", "", "warning");
            currentUrl = url;

            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('videoInfo').classList.add('hidden');

            try {
                const res = await fetch('/fetch_info', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({url})
                });
                const data = await res.json();
                if (data.title) {
                    document.getElementById('title').textContent = data.title;
                    document.getElementById('channel').textContent = data.channel;
                    document.getElementById('thumb').src = data.thumbnail;
                    document.getElementById('videoInfo').classList.remove('hidden');
                }
            } catch { Swal.fire("ভুল লিংক!", "", "error"); }
            document.getElementById('loading').classList.add('hidden');
        }

        function triggerDownload(type) {
            if (!currentUrl) return Swal.fire("প্রথমে Fetch কর!", "", "info");

            const res = document.getElementById('resolution').value;
            const bitrate = res === 'audio' ? document.getElementById('audioBitrate').value : '192';
            const playlist = document.getElementById('playlist').checked ? '1' : '0';

            const params = new URLSearchParams({
                url: currentUrl,
                type: type,
                res: res,
                bitrate: bitrate,
                playlist: playlist
            });

            // এই লাইনটাই ম্যাজিক — Chrome নিচে ডাউনলোড দেখাবে!
            const link = document.createElement('a');
            link.href = '/real_download?' + params.toString();
            link.download = '';  // এটা থাকলে ফোর্স ডাউনলোড হয়
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
